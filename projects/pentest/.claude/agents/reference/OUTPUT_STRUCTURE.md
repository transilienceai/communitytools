# Agent Output Structure

All pentest agents follow standardized output formats.

## Activity Log (NDJSON)

**Location**: `outputs/{engagement}/activity/{agent-name}.log`

**Format**: One JSON object per line

**Orchestrator logs**:
```json
{"timestamp":"2025-01-15T10:00:00Z","agent":"pentester-orchestrator","phase":"init","target":"example.com","result":"success"}
{"timestamp":"2025-01-15T10:05:00Z","agent":"pentester-orchestrator","phase":"recon","action":"deploy-mcp","result":"4 tools deployed"}
{"timestamp":"2025-01-15T10:20:00Z","agent":"pentester-orchestrator","phase":"planning","action":"create-plan","executors":15,"result":"plan-ready"}
{"timestamp":"2025-01-15T10:25:00Z","agent":"pentester-orchestrator","phase":"planning","action":"user-approval","result":"approved"}
{"timestamp":"2025-01-15T10:30:00Z","agent":"pentester-orchestrator","phase":"testing","action":"deploy-executors","count":15,"result":"success"}
```

**Executor logs**:
```json
{"timestamp":"2025-01-15T10:30:45Z","agent":"sql-injection-executor","action":"recon","target":"https://target.com/login","result":"found 3 parameters"}
{"timestamp":"2025-01-15T10:31:12Z","agent":"sql-injection-executor","action":"experiment","payload":"' OR '1'='1","result":"error - WAF blocked"}
{"timestamp":"2025-01-15T10:32:05Z","agent":"sql-injection-executor","action":"test","payload":"' UNION SELECT NULL--","result":"success - 200 OK"}
{"timestamp":"2025-01-15T10:33:20Z","agent":"sql-injection-executor","action":"verify","finding":"finding-001","result":"PoC confirmed"}
```

**Fields**:
- `timestamp` - ISO 8601 format
- `agent` - Agent name (lowercase-hyphenated)
- `phase` - Orchestrator: init, recon, planning, testing, aggregate, reporting
- `action` - Specific action: create-plan, user-approval, deploy-executors, recon, experiment, test, verify
- `target` - URL or endpoint tested
- `payload` - Attack payload (if applicable)
- `result` - Outcome description

## Finding Structure

**Location**: `outputs/{engagement}/findings/finding-{NNN}/`

**Required files**:
```
finding-001/
├── description.md    # Vulnerability details + impact
├── poc.py           # Automated exploit script
├── poc_output.txt   # Script execution proof
├── workflow.md      # Manual reproduction steps
└── evidence/        # Screenshots, HTTP logs, videos
    ├── request.txt
    ├── response.txt
    └── screenshot.png
```

### description.md Template

```markdown
# [Vulnerability Type] in [Location]

**Severity**: Critical/High/Medium/Low
**CVSS**: 9.1 (AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:N)

## Technical Details
[How the vulnerability works]

## Business Impact
[What an attacker can do, what data is at risk]

## Remediation
[Specific fix recommendations]
```

### poc.py Template

```python
#!/usr/bin/env python3
"""
SQL Injection in Login Form
Target: https://target.com/login
"""

import requests

target = "https://target.com/login"
payload = "' UNION SELECT username,password FROM users--"

response = requests.post(target, data={"username": payload, "password": "x"})
print(f"Status: {response.status_code}")
print(f"Leaked data: {response.text}")
```

### workflow.md Template

```markdown
# Manual Reproduction

1. Navigate to https://target.com/login
2. Enter payload in username: `' UNION SELECT username,password FROM users--`
3. Enter any password
4. Click "Login"
5. Observe: Database contents displayed in error message
```

## Aggregated Report (Orchestrator Only)

**Location**: `outputs/{engagement}/pentest-report.json`

**Format**:
```json
{
  "engagement": "example-com-2025-01",
  "target": "https://example.com",
  "date": "2025-01-15",
  "agents_deployed": ["sql-injection-executor", "xss-executor", "ssrf-executor"],
  "findings": [
    {
      "id": "finding-001",
      "title": "SQL Injection in Login Form",
      "severity": "critical",
      "cvss": 9.1,
      "verified": true
    }
  ],
  "summary": {
    "critical": 2,
    "high": 5,
    "medium": 8,
    "low": 3
  }
}
```

## Rules

- **Always log**: Every action to activity log
- **Always capture**: Evidence for every finding
- **Always verify**: Working PoC required
- **No theoreticals**: Only confirmed vulnerabilities
