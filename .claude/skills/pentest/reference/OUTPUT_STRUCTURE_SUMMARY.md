# Pentest Output Structure - Summary

**Goal**: Every pentest agent generates standardized outputs. Simple, short, machine-readable.

## Three-Layer Output Model

### Layer 1: Agent Activity Logs (During testing)

**What**: Each agent records what it did
**Where**: `activity/{agent-name}.log`
**Format**: NDJSON (one JSON object per line)

```json
{"timestamp": "2025-02-02T14:23:15Z", "agent": "sql-injection", "action": "start", "target": "https://example.com/search"}
{"timestamp": "2025-02-02T14:23:22Z", "agent": "sql-injection", "action": "test_payload", "payload": "' OR '1'='1", "result": "vulnerable"}
{"timestamp": "2025-02-02T14:23:45Z", "agent": "sql-injection", "action": "verified_poc", "finding_id": "F-001", "severity": "critical"}
{"timestamp": "2025-02-02T14:25:00Z", "agent": "sql-injection", "action": "complete", "findings": 3, "status": "success"}
```

**Why**:
- Audit trail of what happened
- Debugging: see exact sequence of events
- Transparency: stakeholders understand agent workflow
- Simple parsing: one line = one event

### Layer 2: Finding Folders (Standard format)

**What**: Detailed vulnerability documentation
**Where**: `findings/finding-NNN/`
**Structure**:
- `poc.py` - Working exploit script
- `poc_output.txt` - Proof it works
- `workflow.md` - Manual steps to reproduce
- `description.md` - Technical details

**Why**: ALREADY STANDARDIZED IN OUTPUT_STANDARDS.md
- No changes needed here
- Continues to use existing structure

### Layer 3: Final Pentest Report (After all agents)

**What**: Summary of all findings
**Where**: `pentest-report.json`
**Format**: Simple JSON

```json
{
  "engagement": "acme-corp-2025-02",
  "generated": "2025-02-02T16:00:00Z",
  "summary": {
    "total_findings": 47,
    "critical": 4,
    "high": 12,
    "medium": 18,
    "low": 9,
    "info": 4
  },
  "agents_run": ["sql-injection", "xss", "ssrf", "path-traversal", "xxe"],
  "findings": [
    {
      "id": "F-001",
      "type": "SQL Injection",
      "severity": "critical",
      "cvss": 9.8,
      "url": "https://example.com/search?q=",
      "poc_verified": true,
      "evidence": "findings/finding-001/poc_output.txt"
    }
  ],
  "status": "complete"
}
```

**Why**:
- Quick summary for non-technical stakeholders
- Machine-readable for automation
- References existing finding folders (no duplication)
- Minimal and focused

## Complete Directory Structure

```
outputs/{engagement}/
├── activity/                          ← Layer 1: Agent logs
│   ├── sql-injection.log             (NDJSON)
│   ├── xss.log
│   ├── ssrf.log
│   └── ...
│
├── findings/                          ← Layer 2: Standard findings
│   ├── findings.json
│   ├── finding-001/
│   │   ├── poc.py
│   │   ├── poc_output.txt
│   │   ├── workflow.md
│   │   └── description.md
│   └── finding-NNN/
│
├── evidence/
│   ├── screenshots/
│   ├── requests/
│   └── videos/
│
├── pentest-report.json               ← Layer 3: Final report
└── phase-*.md                        (Phase-based reports)
```

## Workflow Timeline

```
┌─────────────────────────────────────────────────────────┐
│ Phase 3: Vulnerability Testing                          │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  14:23:00 - SQL Injection agent starts                │
│  14:23:15 - Test payloads (activity log updated)      │
│  14:23:45 - PoC verified (activity + finding folder)  │
│  14:25:00 - Agent completes (activity log final)      │
│                                                         │
│  14:25:05 - XSS agent starts                          │
│  14:26:00 - PoCs verified (activity + finding folder) │
│  14:30:00 - Agent completes                           │
│                                                         │
│  ... (more agents)                                    │
│                                                         │
│  16:00:00 - ALL agents complete                       │
│  ↓                                                     │
│  Pentester agent aggregates:                          │
│    - Reads all activity/*.log files                   │
│    - Reads findings/findings.json                     │
│    - Generates pentest-report.json                    │
│                                                         │
│  16:00:30 - Reports complete                         │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

## Implementation Checklist

### For Individual Agents

- [ ] Create `activity/{agent-name}.log`
- [ ] Log "start" action on initialization
- [ ] Log "test_payload" for each payload tested
- [ ] Log "verified_poc" when PoC succeeds
- [ ] Create finding-NNN/ folder with poc.py, poc_output.txt, workflow.md, description.md
- [ ] Log "complete" with findings count and status

### For Pentester Coordinator

- [ ] Read all activity/*.log files
- [ ] Load findings/findings.json
- [ ] Extract agents_run from activity logs
- [ ] Calculate severity breakdown
- [ ] Generate pentest-report.json
- [ ] Validate report structure

### Validation

```bash
# Check activity logs exist and are valid NDJSON
for log in outputs/engagement-123/activity/*.log; do
  echo "Validating $log"
  jq empty "$log" && echo "✓ Valid JSON" || echo "✗ Invalid"
done

# Check pentest-report.json
jq . outputs/engagement-123/pentest-report.json

# Count findings
cat pentest-report.json | jq '.summary'
```

## Key Principles

1. **Activity logs** = WHAT happened (audit trail)
2. **Finding folders** = HOW to reproduce (technical proof)
3. **Final report** = WHY it matters (business summary)

4. **No duplication** = Activity logs don't contain full payloads/POCs
5. **Simple format** = NDJSON + minimal JSON, no complex nesting
6. **Machine-readable** = Parsed by tools, not humans
7. **Human-actionable** = References point to detailed finding folders

## Examples

### Reading Activity Logs

```bash
# Timeline of all agent actions
cat outputs/engagement-123/activity/*.log | jq '.timestamp, .agent, .action'

# Count findings per agent
cat outputs/engagement-123/activity/*.log | jq -s 'group_by(.agent) | map({agent: .[0].agent, findings: map(select(.action=="verified_poc")) | length})'
```

### Using Final Report

```bash
# Extract critical findings
cat outputs/engagement-123/pentest-report.json | jq '.findings[] | select(.severity == "critical")'

# Show findings summary
cat outputs/engagement-123/pentest-report.json | jq '.summary'

# List all agents run
cat outputs/engagement-123/pentest-report.json | jq '.agents_run'
```

---

**Reference**:
- [AGENT_OUTPUT_STRUCTURE.md](AGENT_OUTPUT_STRUCTURE.md) - Detailed format specs
- [AGENT_ACTIVITY_LOG_TEMPLATE.md](AGENT_ACTIVITY_LOG_TEMPLATE.md) - Code examples
- [PHASE_REPORTING.md](intermediate-reports/PHASE_REPORTING.md) - Phase-based reports
