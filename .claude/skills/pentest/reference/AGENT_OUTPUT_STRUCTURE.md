# Agent Output Structure - Simple & Standardized

Simple, consistent output formats for pentest agents. **Very short, very simple.**

## Two Output Files Per Agent

### 1. Agent Activity Log (During Testing)

**File**: `outputs/{engagement}/activity/{agent-name}.log`

**Format**: Simple newline-delimited JSON (NDJSON)

```json
{"timestamp": "2025-02-02T14:23:15Z", "agent": "sql-injection", "action": "start", "target": "https://example.com/search"}
{"timestamp": "2025-02-02T14:23:22Z", "agent": "sql-injection", "action": "test_payload", "payload": "' OR '1'='1", "endpoint": "/search?q=", "result": "vulnerable"}
{"timestamp": "2025-02-02T14:24:00Z", "agent": "sql-injection", "action": "verified_poc", "finding_id": "F-001", "severity": "critical"}
{"timestamp": "2025-02-02T14:25:00Z", "agent": "sql-injection", "action": "complete", "findings": 3, "status": "success"}
```

**Required fields**:
- `timestamp` - ISO 8601 timestamp
- `agent` - Agent name (sql-injection, xss, ssrf, etc.)
- `action` - What happened (start, test_payload, verified_poc, error, complete)
- Additional fields depend on action type

**Action types**:
- `start` - Agent started (target required)
- `test_payload` - Tested a payload (payload, endpoint, result required)
- `verified_poc` - PoC verified (finding_id, severity required)
- `error` - Error occurred (message required)
- `complete` - Agent finished (findings count, status required)

### 2. Final Pentest Output Report

**File**: `outputs/{engagement}/pentest-report.json`

**Format**: Minimal JSON structure

```json
{
  "engagement": "acme-corp-2025-02",
  "generated": "2025-02-02T16:00:00Z",
  "summary": {
    "total_findings": 47,
    "critical": 4,
    "high": 12,
    "medium": 18,
    "low": 9,
    "info": 4
  },
  "agents_run": [
    "sql-injection",
    "xss",
    "ssrf",
    "path-traversal",
    "xxe"
  ],
  "findings": [
    {
      "id": "F-001",
      "type": "SQL Injection",
      "severity": "critical",
      "cvss": 9.8,
      "url": "https://example.com/search?q=",
      "poc_verified": true,
      "evidence": "findings/finding-001/poc_output.txt"
    },
    {
      "id": "F-002",
      "type": "Stored XSS",
      "severity": "high",
      "cvss": 7.1,
      "url": "https://example.com/comments",
      "poc_verified": true,
      "evidence": "findings/finding-002/poc_output.txt"
    }
  ],
  "status": "complete"
}
```

**Required fields**:
- `engagement` - Engagement name/ID
- `generated` - Report generation timestamp
- `summary` - Severity breakdown (count by critical/high/medium/low/info)
- `agents_run` - List of agent names that executed
- `findings` - Array of findings (minimal)
- `status` - complete/incomplete/error

## Directory Structure

```
outputs/{engagement}/
├── activity/
│   ├── sql-injection.log
│   ├── xss.log
│   ├── ssrf.log
│   └── ...
├── pentest-report.json
├── findings/
│   ├── findings.json
│   ├── finding-001/
│   │   ├── poc.py
│   │   ├── poc_output.txt
│   │   ├── workflow.md
│   │   └── description.md
│   └── finding-NNN/
└── evidence/
    ├── screenshots/
    ├── requests/
    └── videos/
```

## Agent Responsibilities

**During testing**:
1. Create `activity/{agent-name}.log`
2. Write NDJSON line for each action
3. On completion, write final summary

**After all agents complete**:
1. Pentester agent aggregates findings
2. Generates `pentest-report.json`
3. References existing finding folders

## Pentester Agent Aggregation

```javascript
// Pseudocode: pentester agent aggregation
const activityLogs = loadActivityLogs('./activity/')  // All .log files
const findings = loadFindings('./findings/findings.json')

const report = {
  engagement: config.engagement,
  generated: now(),
  summary: summarizeSeverity(findings),
  agents_run: extractAgentNames(activityLogs),
  findings: findings.map(f => ({
    id: f.id,
    type: f.type,
    severity: f.severity,
    cvss: f.cvss,
    url: f.url,
    poc_verified: hasVerifiedPoc(f),
    evidence: f.evidence_path
  })),
  status: 'complete'
}

write('pentest-report.json', JSON.stringify(report, null, 2))
```

## Example Agent Output Timeline

### Activity Logs (realtime, per agent)

```
Agent: sql-injection
14:23:15 - START: Testing https://example.com/search
14:23:22 - TEST: Payload "' OR '1'='1" on /search?q= → VULNERABLE
14:23:45 - POC: Verified (finding-001, CVSS 9.8)
14:25:00 - COMPLETE: 3 findings discovered
```

### Final Report (aggregated)

```json
{
  "engagement": "acme-corp-2025-02",
  "generated": "2025-02-02T16:00:00Z",
  "summary": {
    "total_findings": 47,
    "critical": 4,
    "high": 12,
    "medium": 18,
    "low": 9,
    "info": 4
  },
  "agents_run": [
    "sql-injection",
    "xss",
    "ssrf",
    "path-traversal",
    "xxe",
    "jwt",
    "auth-bypass"
  ],
  "findings": [
    {"id": "F-001", "type": "SQL Injection", "severity": "critical", "cvss": 9.8, ...},
    {"id": "F-002", "type": "Stored XSS", "severity": "high", "cvss": 7.1, ...},
    ...
  ],
  "status": "complete"
}
```

## Key Principles

1. **Activity logs** = What agents did (for auditing, debugging)
2. **Final report** = What was found (for stakeholders)
3. **Both formats** = Simple, minimal, machine-readable
4. **No duplication** = Activity logs don't contain raw payloads/data
5. **Evidence preserved** = References point to existing finding folders

---

**Use this structure for ALL pentest agents to ensure consistency.**
